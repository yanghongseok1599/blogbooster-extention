<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>블로그 부스터 Pro - 관리자</title>
  <link rel="icon" type="image/png" sizes="16x16" href="../icons/icon16.png">
  <link rel="icon" type="image/png" sizes="48x48" href="../icons/icon48.png">
  <link rel="stylesheet" href="admin.css">
</head>
<body>
  <div class="admin-container">
    <header class="admin-header">
      <div class="logo">
        <span class="logo-icon">⚙️</span>
        <h1>관리자 페이지</h1>
      </div>
      <div class="admin-badge">ADMIN</div>
    </header>

    <!-- 관리자 인증 -->
    <div class="auth-section" id="authSection">
      <div class="auth-card">
        <h2>관리자 인증</h2>
        <p>관리자 비밀번호를 입력하세요</p>
        <div class="input-group">
          <input type="password" id="adminPassword" placeholder="관리자 비밀번호" />
          <button class="btn primary" id="authBtn">인증</button>
        </div>
        <div class="status-message error" id="authError" style="display: none;"></div>
      </div>
    </div>

    <!-- 관리자 메인 (인증 후 표시) -->
    <main class="admin-main" id="adminMain" style="display: none;">

      <!-- 프로모션 코드 발행 -->
      <section class="admin-section">
        <h2 class="section-title">
          <span>🎫</span> 프로모션 코드 발행
        </h2>

        <div class="promo-card">
          <div class="promo-info">
            <p>1회용 프로모션 코드를 발행합니다.</p>
            <ul>
              <li>코드 사용 시 <strong>PRO 3개월</strong> 무료 이용권 지급</li>
              <li>발행 후 <strong>24시간</strong> 이내 사용 필요</li>
              <li>1회 사용 후 자동 만료</li>
            </ul>
          </div>

          <div class="generate-section">
            <div class="generate-options">
              <label>
                <span>발행 개수:</span>
                <select id="codeCount">
                  <option value="1">1개</option>
                  <option value="5">5개</option>
                  <option value="10">10개</option>
                  <option value="20">20개</option>
                </select>
              </label>
              <label>
                <span>유효기간:</span>
                <select id="codeExpiry">
                  <option value="24">24시간</option>
                  <option value="48">48시간</option>
                  <option value="72">72시간</option>
                  <option value="168">7일</option>
                </select>
              </label>
              <label>
                <span>혜택:</span>
                <select id="codeBenefit">
                  <option value="pro_3months">PRO 3개월</option>
                  <option value="pro_1month">PRO 1개월</option>
                  <option value="unlimited_3months">무제한 3개월</option>
                </select>
              </label>
            </div>
            <button class="btn generate-btn" id="generateCodeBtn">
              <span class="btn-icon">🎟️</span>
              코드 발행하기
            </button>
          </div>

          <!-- 생성된 코드 표시 -->
          <div class="generated-codes" id="generatedCodes" style="display: none;">
            <div class="codes-header">
              <h3>발행된 코드</h3>
              <button class="btn small" id="copyAllCodes">전체 복사</button>
            </div>
            <div class="codes-list" id="codesList"></div>
          </div>
        </div>
      </section>

      <!-- 활성 코드 목록 -->
      <section class="admin-section">
        <h2 class="section-title">
          <span>📋</span> 활성 코드 목록
        </h2>

        <div class="codes-table-card">
          <div class="table-header">
            <div class="search-box">
              <input type="text" id="searchCode" placeholder="코드 검색..." />
            </div>
            <button class="btn small danger" id="cleanExpiredBtn">만료 코드 정리</button>
          </div>

          <div class="table-container">
            <table class="codes-table" id="codesTable">
              <thead>
                <tr>
                  <th>코드</th>
                  <th>혜택</th>
                  <th>생성일</th>
                  <th>만료일</th>
                  <th>상태</th>
                  <th>액션</th>
                </tr>
              </thead>
              <tbody id="codesTableBody">
                <tr class="empty-row">
                  <td colspan="6">발행된 코드가 없습니다</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- 사용 통계 -->
      <section class="admin-section">
        <h2 class="section-title">
          <span>📊</span> 사용 통계
        </h2>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">🎫</div>
            <div class="stat-value" id="totalCodes">0</div>
            <div class="stat-label">총 발행 코드</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">✅</div>
            <div class="stat-value" id="usedCodes">0</div>
            <div class="stat-label">사용된 코드</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">⏳</div>
            <div class="stat-value" id="activeCodes">0</div>
            <div class="stat-label">활성 코드</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">❌</div>
            <div class="stat-value" id="expiredCodes">0</div>
            <div class="stat-label">만료된 코드</div>
          </div>
        </div>
      </section>

      <!-- 가입 유저 목록 -->
      <section class="admin-section">
        <h2 class="section-title">
          <span>👥</span> 가입 유저 목록
        </h2>

        <div class="users-list-card">
          <div class="table-header">
            <button class="btn primary" id="loadUsersListBtn">
              <span class="btn-icon">🔄</span> 유저 목록 불러오기
            </button>
            <span class="data-count" id="usersListCount"></span>
          </div>

          <div class="table-container">
            <table class="users-table" id="usersListTable">
              <thead>
                <tr>
                  <th>이메일</th>
                  <th>닉네임</th>
                  <th>플랜</th>
                  <th>만료일</th>
                  <th>가입일</th>
                  <th>마지막 로그인</th>
                  <th>관리</th>
                </tr>
              </thead>
              <tbody id="usersListBody">
                <tr class="empty-row">
                  <td colspan="7">유저 목록을 불러오려면 버튼을 클릭하세요</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- 사용자 학습 데이터 -->
      <section class="admin-section">
        <h2 class="section-title">
          <span>🧠</span> 사용자 학습 데이터
        </h2>

        <div class="users-data-card">
          <div class="table-header">
            <button class="btn primary" id="loadUsersDataBtn">
              <span class="btn-icon">🔄</span> 데이터 불러오기
            </button>
            <span class="data-count" id="usersDataCount"></span>
          </div>

          <div class="table-container">
            <table class="users-table" id="usersDataTable">
              <thead>
                <tr>
                  <th>사용자 ID</th>
                  <th>분석 횟수</th>
                  <th>평균 SEO 점수</th>
                  <th>주요 스타일</th>
                  <th>주요 업종</th>
                  <th>마지막 업데이트</th>
                  <th>상세</th>
                </tr>
              </thead>
              <tbody id="usersDataBody">
                <tr class="empty-row">
                  <td colspan="7">데이터를 불러오려면 '데이터 불러오기' 버튼을 클릭하세요</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- 생성된 글 목록 -->
      <section class="admin-section">
        <h2 class="section-title">
          <span>📝</span> 생성된 글 목록
        </h2>

        <div class="posts-card">
          <div class="table-header">
            <button class="btn primary" id="loadPostsBtn">
              <span class="btn-icon">🔄</span> 글 목록 불러오기
            </button>
            <span class="data-count" id="postsCount"></span>
          </div>

          <div class="posts-list" id="postsList">
            <div class="empty-message">글 목록을 불러오려면 버튼을 클릭하세요</div>
          </div>
        </div>
      </section>

      <!-- 관리자 설정 -->
      <section class="admin-section">
        <h2 class="section-title">
          <span>🔐</span> 관리자 설정
        </h2>

        <div class="settings-card">
          <div class="setting-row">
            <div class="setting-info">
              <h4>관리자 비밀번호 변경</h4>
              <p>관리자 페이지 접근 비밀번호를 변경합니다.</p>
            </div>
            <div class="setting-input">
              <input type="password" id="newAdminPassword" placeholder="새 비밀번호" />
              <button class="btn small" id="changePasswordBtn">변경</button>
            </div>
          </div>

          <div class="setting-row">
            <div class="setting-info">
              <h4>Gemini API 키 (서버용)</h4>
              <p>Firebase에 저장되며, 유료 구독자만 사용할 수 있습니다.</p>
            </div>
            <div class="setting-input">
              <input type="password" id="serverApiKey" placeholder="API 키" />
              <button class="btn small" id="saveServerApiBtn">저장</button>
            </div>
          </div>

          <div class="setting-row">
            <div class="setting-info">
              <h4>무료 사용자 API 접근</h4>
              <p>체크하면 무료 사용자도 AI 기능을 사용할 수 있습니다.</p>
            </div>
            <div class="setting-input">
              <label class="checkbox-label">
                <input type="checkbox" id="freeAccessEnabled" />
                <span>무료 사용자 허용</span>
              </label>
            </div>
          </div>

          <div class="setting-row">
            <div class="setting-info">
              <h4>YouTube API 키</h4>
              <p>YouTube 자막 추출 기능에 사용됩니다. 여러 개 입력 시 줄바꿈으로 구분합니다.</p>
            </div>
            <div class="setting-input wide">
              <textarea id="youtubeApiKeys" rows="3" placeholder="YouTube API 키 (줄바꿈으로 구분)"></textarea>
              <button class="btn small" id="saveYouTubeApiBtn">저장</button>
            </div>
          </div>
        </div>
      </section>

    </main>

    <footer class="admin-footer">
      <p>블로그 부스터 Pro 관리자 페이지 v2.0</p>
    </footer>
  </div>

  <!-- 학습 데이터 상세 모달 -->
  <div class="modal-overlay" id="learningDetailModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>학습 데이터 상세</h3>
        <button class="modal-close" id="closeLearningModal">&times;</button>
      </div>
      <div class="modal-body" id="learningDetailContent">
        <!-- 상세 내용이 여기에 표시됨 -->
      </div>
    </div>
  </div>

  <!-- 글 내용 모달 -->
  <div class="modal-overlay" id="postDetailModal" style="display: none;">
    <div class="modal-content large">
      <div class="modal-header">
        <h3 id="postDetailTitle">글 내용</h3>
        <button class="modal-close" id="closePostModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="post-content" id="postDetailContent">
          <!-- 글 내용이 여기에 표시됨 -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="copyPostContent">내용 복사</button>
      </div>
    </div>
  </div>

  <!-- 유저 플랜 수정 모달 -->
  <div class="modal-overlay" id="userPlanModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>유저 플랜 관리</h3>
        <button class="modal-close" id="closeUserPlanModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="user-plan-form">
          <input type="hidden" id="editUserId" />

          <div class="form-row">
            <label>이메일</label>
            <div class="form-value" id="editUserEmail">-</div>
          </div>

          <div class="form-row">
            <label>닉네임</label>
            <div class="form-value" id="editUserNickname">-</div>
          </div>

          <div class="form-row">
            <label>현재 플랜</label>
            <div class="form-value" id="editCurrentPlan">-</div>
          </div>

          <div class="form-row">
            <label for="editPlanSelect">플랜 변경</label>
            <select id="editPlanSelect">
              <option value="free">무료 (Free)</option>
              <option value="pro">프로 (Pro)</option>
              <option value="unlimited">무제한 (Unlimited)</option>
            </select>
          </div>

          <div class="form-row">
            <label for="editPlanExpiry">만료일</label>
            <input type="date" id="editPlanExpiry" />
            <small class="form-hint">무료 플랜은 만료일이 적용되지 않습니다.</small>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="cancelUserPlan">취소</button>
        <button class="btn primary" id="saveUserPlan">저장</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK for authentication -->
  <script src="../lib/firebase-app-compat.js"></script>
  <script src="../lib/firebase-auth-compat.js"></script>
  <script src="../lib/firebase-firestore-compat.js"></script>
  <script src="../lib/env-config.js"></script>
  <script src="../lib/firebase-config.js"></script>
  <script src="admin.js"></script>
</body>
</html>
